# ğŸ³ ã‚µãƒ³ãƒ‰ãƒœãƒƒã‚¯ã‚¹ã‚µãƒ¼ãƒ“ã‚¹ä½¿ç”¨ã‚¬ã‚¤ãƒ‰

## ğŸ“‹ æ¦‚è¦
ã“ã®ã‚µãƒ³ãƒ‰ãƒœãƒƒã‚¯ã‚¹ã‚µãƒ¼ãƒ“ã‚¹ã¯ã€Dockerã‚³ãƒ³ãƒ†ãƒŠã§Pythonã‚³ãƒ¼ãƒ‰ã‚’å®‰å…¨ã«å®Ÿè¡Œã™ã‚‹ãŸã‚ã®ã‚µãƒ¼ãƒ“ã‚¹ã§ã™ã€‚

## âœ¨ ä¸»ãªæ©Ÿèƒ½
- **å®‰å…¨ãªå®Ÿè¡Œç’°å¢ƒ**: Dockerã‚³ãƒ³ãƒ†ãƒŠã§ã‚³ãƒ¼ãƒ‰ã‚’åˆ†é›¢å®Ÿè¡Œ
- **ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£åˆ¶é™**: ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ç„¡åŠ¹ã€ãƒ¡ãƒ¢ãƒªåˆ¶é™ï¼ˆ128MBï¼‰
- **ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆåˆ¶å¾¡**: 5ç§’ã§ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ
- **ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°**: æ§‹æ–‡ã‚¨ãƒ©ãƒ¼ã€å®Ÿè¡Œæ™‚ã‚¨ãƒ©ãƒ¼ã®è©³ç´°æ¤œå‡º
- **æ¨™æº–å…¥åŠ›ã‚µãƒãƒ¼ãƒˆ**: stdinã«ã‚ˆã‚‹å…¥åŠ›ãƒ‡ãƒ¼ã‚¿ã®å—ã‘æ¸¡ã—
- **åŒæœŸãƒ»éåŒæœŸå®Ÿè¡Œ**: ä¸¡æ–¹ã®ãƒ¢ãƒ¼ãƒ‰ã‚’ã‚µãƒãƒ¼ãƒˆ

## ğŸš€ åŸºæœ¬çš„ãªä½¿ç”¨æ–¹æ³•

### 1. ã‚¤ãƒ³ãƒãƒ¼ãƒˆ
```python
from services.sandbox_service import (
    execute_python_code_sync,      # åŒæœŸå®Ÿè¡Œ
    execute_python_code_in_docker, # éåŒæœŸå®Ÿè¡Œ
    CodeExecutionResult            # çµæœã®å‹
)
```

### 2. åŒæœŸå®Ÿè¡Œã®ä¾‹
```python
# åŸºæœ¬çš„ãªã‚³ãƒ¼ãƒ‰å®Ÿè¡Œ
result = execute_python_code_sync('print("Hello, World!")')
print(f"å‡ºåŠ›: {result.stdout}")
print(f"æˆåŠŸ: {result.succeeded}")
print(f"å®Ÿè¡Œæ™‚é–“: {result.execution_time_ms}ms")
```

### 3. éåŒæœŸå®Ÿè¡Œã®ä¾‹
```python
import asyncio

async def main():
    result = await execute_python_code_in_docker('print("Hello, Async!")')
    print(f"å‡ºåŠ›: {result.stdout}")

asyncio.run(main())
```

## ğŸ“ å®Ÿè¡Œçµæœã®æ§‹é€ 

`CodeExecutionResult`å‹ã«ã¯ä»¥ä¸‹ã®æƒ…å ±ãŒå«ã¾ã‚Œã¾ã™ï¼š

```python
class CodeExecutionResult:
    stdout: str              # æ¨™æº–å‡ºåŠ›
    stderr: str              # ã‚¨ãƒ©ãƒ¼å‡ºåŠ›
    execution_time_ms: float # å®Ÿè¡Œæ™‚é–“ï¼ˆãƒŸãƒªç§’ï¼‰
    exit_code: int           # çµ‚äº†ã‚³ãƒ¼ãƒ‰
    error_type: str | None   # ã‚¨ãƒ©ãƒ¼ã‚¿ã‚¤ãƒ—
    succeeded: bool          # å®Ÿè¡ŒæˆåŠŸåˆ¤å®š
```

## ğŸ’¡ ä½¿ç”¨ä¾‹

### åŸºæœ¬çš„ãªã‚³ãƒ¼ãƒ‰å®Ÿè¡Œ
```python
result = execute_python_code_sync('''
print("Hello, World!")
x = 10 + 20
print(f"è¨ˆç®—çµæœ: {x}")
''')

if result.succeeded:
    print("å®Ÿè¡ŒæˆåŠŸ!")
    print(f"å‡ºåŠ›: {result.stdout}")
else:
    print("å®Ÿè¡Œå¤±æ•—")
    print(f"ã‚¨ãƒ©ãƒ¼: {result.stderr}")
```

### æ¨™æº–å…¥åŠ›ã‚’ä½¿ç”¨
```python
code = '''
name = input("ãŠåå‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„: ")
age = int(input("å¹´é½¢ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„: "))
print(f"ã“ã‚“ã«ã¡ã¯ã€{name}ã•ã‚“ï¼")
print(f"ã‚ãªãŸã¯{age}æ­³ã§ã™ã­ã€‚")
'''

# å…¥åŠ›ãƒ‡ãƒ¼ã‚¿ã‚’æº–å‚™
stdin_data = "ç”°ä¸­å¤ªéƒ\n25\n"

result = execute_python_code_sync(code, stdin_input=stdin_data)
print(f"å‡ºåŠ›:\n{result.stdout}")
```

### ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
```python
# ã‚¼ãƒ­é™¤ç®—ã‚¨ãƒ©ãƒ¼ã®ä¾‹
result = execute_python_code_sync('x = 1 / 0')

print(f"æˆåŠŸ: {result.succeeded}")
print(f"ã‚¨ãƒ©ãƒ¼ã‚¿ã‚¤ãƒ—: {result.error_type}")  # "ZeroDivisionError"
print(f"ã‚¨ãƒ©ãƒ¼å†…å®¹: {result.stderr}")
```

### è¤‡é›‘ãªè¨ˆç®—ã®ä¾‹
```python
code = '''
def fibonacci(n):
    if n <= 1:
        return n
    return fibonacci(n-1) + fibonacci(n-2)

# æœ€åˆã®10å€‹ã®ãƒ•ã‚£ãƒœãƒŠãƒƒãƒæ•°ã‚’è¨ˆç®—
fib_numbers = [fibonacci(i) for i in range(10)]
print(f"ãƒ•ã‚£ãƒœãƒŠãƒƒãƒæ•°åˆ—: {fib_numbers}")

# å¹³å‡ã‚’è¨ˆç®—
average = sum(fib_numbers) / len(fib_numbers)
print(f"å¹³å‡: {average:.2f}")
'''

result = execute_python_code_sync(code)
print(f"å‡ºåŠ›:\n{result.stdout}")
print(f"å®Ÿè¡Œæ™‚é–“: {result.execution_time_ms:.2f}ms")
```

## ğŸ” æ¤œå‡ºå¯èƒ½ãªã‚¨ãƒ©ãƒ¼ã‚¿ã‚¤ãƒ—

- `TimeoutError`: 5ç§’ã§ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ
- `SyntaxError`: æ§‹æ–‡ã‚¨ãƒ©ãƒ¼
- `NameError`: æœªå®šç¾©å¤‰æ•°ã®ä½¿ç”¨
- `TypeError`: å‹ã‚¨ãƒ©ãƒ¼  
- `ValueError`: å€¤ã‚¨ãƒ©ãƒ¼
- `IndexError`: ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚¨ãƒ©ãƒ¼
- `KeyError`: ã‚­ãƒ¼ã‚¨ãƒ©ãƒ¼
- `ZeroDivisionError`: ã‚¼ãƒ­é™¤ç®—ã‚¨ãƒ©ãƒ¼
- `RuntimeError`: ãã®ä»–ã®å®Ÿè¡Œæ™‚ã‚¨ãƒ©ãƒ¼

## âš ï¸ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£åˆ¶é™

ã“ã®ã‚µãƒ³ãƒ‰ãƒœãƒƒã‚¯ã‚¹ã«ã¯ä»¥ä¸‹ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£åˆ¶é™ãŒã‚ã‚Šã¾ã™ï¼š

- **ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¢ã‚¯ã‚»ã‚¹ç„¡åŠ¹**: å¤–éƒ¨æ¥ç¶šä¸å¯
- **ãƒ¡ãƒ¢ãƒªåˆ¶é™**: 128MBã¾ã§
- **å®Ÿè¡Œæ™‚é–“åˆ¶é™**: 5ç§’ã§ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ
- **ãƒ•ã‚¡ã‚¤ãƒ«ã‚·ã‚¹ãƒ†ãƒ **: èª­ã¿å–ã‚Šå°‚ç”¨

## ğŸ§ª ãƒ†ã‚¹ãƒˆã®å®Ÿè¡Œ

å®Ÿè£…ã•ã‚ŒãŸãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½¿ç”¨ã—ã¦ã‚µãƒ¼ãƒ“ã‚¹ã‚’æ¤œè¨¼ã§ãã¾ã™ï¼š

```bash
# åŸºæœ¬ãƒ†ã‚¹ãƒˆ
python simple_sandbox_test.py

# å®Œå…¨ãªãƒ†ã‚¹ãƒˆ
python test_sandbox_complete.py

# ä½¿ç”¨ä¾‹ã®å®Ÿè¡Œ
python example_usage.py
```

## ğŸ”§ ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### DockerãŒè¦‹ã¤ã‹ã‚‰ãªã„å ´åˆ
```bash
# Docker ãƒ‡ãƒ¼ãƒ¢ãƒ³ãŒå®Ÿè¡Œä¸­ã‹ç¢ºèª
docker --version
docker ps

# Dockerã‚¤ãƒ¡ãƒ¼ã‚¸ã®ãƒ—ãƒ«
docker pull python:3.11-slim
```

### ImportError ãŒç™ºç”Ÿã™ã‚‹å ´åˆ
```python
import sys
import os
sys.path.append(os.path.dirname(__file__))
```

## ğŸ“š å‚è€ƒè³‡æ–™

- [Docker SDK for Python](https://docker-py.readthedocs.io/)
- [Pydantic Models](https://docs.pydantic.dev/)
- å®Ÿè£…ãƒ•ã‚¡ã‚¤ãƒ«: `backend/services/sandbox_service.py`
- ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«: `backend/test_sandbox_complete.py`
- ä½¿ç”¨ä¾‹: `backend/example_usage.py`
